<div class="topnav">
  <div class="drag-region">
    <app-logo size="28px"></app-logo>
    <div class="title-container">
        <span class="app-title">SHIELD</span>
        <span class="version-tag">v{{ github.CURRENT_VERSION }}</span>
    </div>
  </div>
  
  <div class="window-controls">
    <!-- Theme Toggle -->
    <button mat-icon-button (click)="themeService.toggle()" class="theme-toggle" [matTooltip]="themeService.darkMode() ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
        <mat-icon>{{ themeService.darkMode() ? 'light_mode' : 'dark_mode' }}</mat-icon>
    </button>
    
    <!-- Admin Status -->
    <div class="admin-indicator" 
         [class.active]="isAdmin" 
         [matMenuTriggerFor]="adminMenu"
         #adminMenuTrigger="matMenuTrigger">
        @if (isAdmin) {
            <mat-icon class="shield-check">verified_user</mat-icon>
            <span class="label">Admin Mode</span>
        } @else {
            <mat-icon class="shield-warn">gpp_maybe</mat-icon>
            <span class="label">User Mode</span>
        }
    </div>

    <!-- Update Status -->
    <div class="update-indicator">
        @switch (github.updateStatus()) {
            @case ('checking') {
                <div class="status-pill checking">
                    <mat-icon class="spin-slow">sync</mat-icon>
                </div>
            }
            @case ('downloading') {
                 <div class="status-pill downloading">
                    <mat-icon class="pulse-soft">download</mat-icon>
                    <span class="text">Downloading Update...</span>
                 </div>
            }
            @case ('downloaded') {
                 <button (click)="github.quitAndInstall()" class="update-action-btn">
                     <mat-icon>system_update</mat-icon>
                     <span>Restart & Update</span>
                     @if (github.releaseNote()) {
                         <span class="version-pill">{{ github.releaseNote() }}</span>
                     }
                 </button>
            }
            @case ('outdated') {
                <a [href]="github.latestRelease()?.html_url" target="_blank" class="status-pill outdated">
                    <mat-icon>arrow_circle_up</mat-icon>
                    <span>Update Available</span>
                </a>
            }
            @case ('error') {
                 <div class="status-pill error" [title]="github.error()">
                    <mat-icon>wifi_off</mat-icon>
                 </div>
            }
        }
    </div>

    <mat-menu #adminMenu="matMenu" xPosition="before" class="glass-menu">
        <div class="admin-popup-content" (click)="$event.stopPropagation()" (keydown.enter)="$event.stopPropagation()" tabindex="0">
            <div class="header">
                <mat-icon>{{ isAdmin ? 'verified_user' : 'gpp_maybe' }}</mat-icon>
                <strong>{{ isAdmin ? 'Protected' : 'Limited Access' }}</strong>
            </div>
            <p>Shield is running with {{ isAdmin ? 'full administrator privileges' : 'standard user privileges' }}.</p>
            
            @if (!isAdmin) {
                <p class="sub-text">Many hardening features require Admin rights to modify system registry keys.</p>
                <div class="actions">
                    <button mat-flat-button color="warn" (click)="toggleAdminMode(); adminMenuTrigger.closeMenu()">
                        <mat-icon>restart_alt</mat-icon>
                        Relaunch as Admin
                    </button>
                </div>
            }
        </div>
    </mat-menu>
    
    <!-- Custom Window Controls -->
    <div class="window-actions">
        <button class="win-btn min" (click)="minimize()">
            <mat-icon>remove</mat-icon>
        </button>
        <button class="win-btn max" (click)="toggleMaximize()">
            <mat-icon>crop_square</mat-icon>
        </button>
        <button class="win-btn close" (click)="close()">
            <mat-icon>close</mat-icon>
        </button>
    </div>
  </div>
</div>
